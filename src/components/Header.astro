---
import Link from '@/components/Link.astro'
import ThemeToggle from '@/components/ThemeToggle.astro'
import MobileMenu from '@/components/ui/mobile-menu'
import SearchButton from '@/components/react/SearchButton'
import { NAV_LINKS } from '@/consts'
import { Icon } from 'astro-icon/components'

const isExternalLink = (href: string) => {
  return href.startsWith('http')
}
---

<header class="bg-background/50 sticky top-0 z-10 backdrop-blur-md" transition:persist>
  <div class="mx-auto flex max-w-3xl flex-wrap items-center justify-between gap-4 p-4">
    <Link href="/" class="flex shrink-0 items-center gap-2 text-xl font-medium" data-astro-reload>
      <img 
        src="/static/logo.svg" 
        alt="Logo" 
        class="size-8 dark:block hidden" 
        width="32" 
        height="32"
        loading="eager"
        fetchpriority="high"
        transition:persist="logo-dark"
      />
      <img 
        src="/static/logod.svg" 
        alt="Logo" 
        class="size-8 dark:hidden block" 
        width="32" 
        height="32"
        loading="eager"
        fetchpriority="high"
        transition:persist="logo-light"
      />
     <!-- <span class="hidden min-[400px]:block">{SITE.title}</span> -->
    </Link>
    <div class="flex items-center gap-2 md:gap-4">
      <nav class="hidden items-center gap-4 text-sm sm:gap-6 md:flex">
        {NAV_LINKS.map((item) => {
          const isExternal = isExternalLink(item.href)
          const isInsideLink = item.label.toLowerCase() === 'inside'
          return (
            <Link 
              href={item.href} 
              class={isInsideLink 
                ? "text-primary hover:text-primary/80 capitalize transition-colors flex items-center gap-1.5 font-medium" 
                : "text-foreground/60 hover:text-foreground/80 capitalize transition-colors flex items-center gap-1.5"}
            >
              <span>{item.label}</span>
              {isExternal && (
                <Icon 
                  name="lucide:external-link" 
                  class={isInsideLink 
                    ? "size-3.5 opacity-80 flex-shrink-0 text-primary" 
                    : "size-3.5 opacity-70 flex-shrink-0"} 
                  aria-hidden="true"
                />
              )}
            </Link>
          )
        })}
      </nav>
      <div class="hidden h-6 w-px bg-border/60 md:block" aria-hidden="true"></div>
      <SearchButton client:idle />
      <MobileMenu client:idle transition:persist />
      <ThemeToggle transition:persist />
    </div>
  </div>
</header>